
<!-- WORK FLOW DIAGRAM -->
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Historical Data â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  train.py   â”‚
            â”‚  (One-time  â”‚
            â”‚  training)  â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Saved Ensemblesâ”‚
         â”‚  models/*.pkl  â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚
        â–¼                 â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ backtest_hybridâ”‚   â”‚ main_hybrid.py â”‚
 â”‚  (Simulated   â”‚   â”‚  Live trading  â”‚
 â”‚  trading)     â”‚   â”‚  bot)          â”‚
 â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Incremental         â”‚ Incremental
       â”‚ retrain every N barsâ”‚ retrain every N bars
       â–¼                     â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚   Trade Logic â”‚      â”‚  Trade Logic  â”‚
 â”‚ (SimPosition, â”‚      â”‚ (Execution &  â”‚
 â”‚ RiskManager)  â”‚      â”‚ RiskManager)  â”‚
 â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â–¼                        â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Equity Curve  â”‚        â”‚ Real Trades   â”‚
 â”‚ trades_hybrid â”‚        â”‚   in MT5      â”‚
 â”‚ .csv          â”‚        â”‚               â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


 <!-- diagram showing the incremental update process per bar -->
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚      New bar arrives         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Build features (X)     â”‚
           â”‚  & labels (y)           â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  Merge features & labelsâ”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Check retrain condition:    â”‚
          â”‚  if bar_count % N == 0      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ Yes
                          â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ Incrementally retrain  â”‚
             â”‚  ensemble with all     â”‚
             â”‚  data up to current barâ”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Save updated ensemble   â”‚
           â”‚  to disk (*.pkl)        â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Predict direction for   â”‚
           â”‚  current bar using X    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Manage open positions        â”‚
          â”‚  & open new position if allowed â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Update equity / trade log   â”‚
          â”‚  (simulation or live)       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


<!-- diagram comparing live hybrid trading vs backtest hybrid -->
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                 NEW BAR                    â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Build features & labels     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Check incremental retrain condition (every N bars) â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                 â”‚
         â–¼                                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Live trading           â”‚        â”‚ Backtest simulation    â”‚
  â”‚ (main_hybrid.py)       â”‚        â”‚ (backtest_hybrid.py)  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Predict with ensemble  â”‚        â”‚ Predict with ensemble  â”‚
  â”‚ Execute trades via MT5 â”‚        â”‚ Simulate positions     â”‚
  â”‚ Manage live PnL        â”‚        â”‚ Update equity curve    â”‚
  â”‚ Save updated ensemble  â”‚        â”‚ Save updated ensemble  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                 â”‚
          â–¼                                 â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Trade log / performanceâ”‚        â”‚ Equity curve / trades â”‚
  â”‚ (real account)         â”‚        â”‚ (simulation)          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


<!-- full workflow diagram -->
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚        train.py             â”‚
                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                 â”‚ - Fetch historical bars     â”‚
                 â”‚ - Build features & labels   â”‚
                 â”‚ - Fit Ensemble models       â”‚
                 â”‚ - Save trained ensembles    â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ Ensemble Models Saved in    â”‚
                 â”‚         /models/            â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                                           â”‚
             â–¼                                           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ main_hybrid.py      â”‚                    â”‚ backtest_hybrid.py  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ Live trading loop   â”‚                    â”‚ Backtest loop       â”‚
   â”‚ ------------------  â”‚                    â”‚ ------------------  â”‚
   â”‚ 1. Fetch latest bar â”‚                    â”‚ 1. Fetch historical bars slice â”‚
   â”‚ 2. Build features   â”‚                    â”‚ 2. Build features   â”‚
   â”‚ 3. Incremental      â”‚                    â”‚ 3. Incremental      â”‚
   â”‚    retrain ensemble â”‚                    â”‚    retrain ensemble â”‚
   â”‚ 4. Predict & trade  â”‚                    â”‚ 4. Predict & simulate trades â”‚
   â”‚ 5. Update live PnL  â”‚                    â”‚ 5. Update simulated equity curve â”‚
   â”‚ 6. Save ensemble    â”‚                    â”‚ 6. Save updated ensemble â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                                           â”‚
                 â–¼                                           â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Real account trades  â”‚                    â”‚ Simulated equity &  â”‚
       â”‚ Trade logs / PnL     â”‚                    â”‚ trades CSV files    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


<!-- Hybrid Incremental Training â€“ Bar-by-Bar Flow -->
Time â†’  | Bar 1 | Bar 2 | Bar 3 | Bar 4 | Bar 5 | Bar 6 | Bar 7 | ...
--------------------------------------------------------------------------------
Fetch   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |
Features|  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |
Labels  |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |
--------------------------------------------------------------------------------
Predict |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |
Decision|  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |
Trade   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |  âœ…   |
--------------------------------------------------------------------------------
Retrain |  âŒ   |  âŒ   |  âœ…   |  âŒ   |  âŒ   |  âœ…   |  âŒ   |
Save    |  âŒ   |  âŒ   |  âœ…   |  âŒ   |  âŒ   |  âœ…   |  âŒ   |



<!-- Hybrid Incremental Model Timeline -->
Time â†’   Bar 1      Bar 2      Bar 3      Bar 4      Bar 5      Bar 6      Bar 7      ...
--------------------------------------------------------------------------------------------
Fetch     âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Features  âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Labels    âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
--------------------------------------------------------------------------------------------
Predict   âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Decision  âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Trade     âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
--------------------------------------------------------------------------------------------
Retrain   âŒ         âŒ         âœ…         âŒ         âŒ         âœ…         âŒ
Save      âŒ         âŒ         ğŸ’¾         âŒ         âŒ         ğŸ’¾         âŒ
--------------------------------------------------------------------------------------------
Ensemble State:
          M1          M1         M2         M2         M2         M3         M3


<!-- Hybrid Bot: Live vs Backtest -->
Time â†’   Bar 1      Bar 2      Bar 3      Bar 4      Bar 5      Bar 6      Bar 7      ...
--------------------------------------------------------------------------------------------
LIVE BOT
Fetch     âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Features  âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Labels    âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Predict   âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Trade     âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Retrain   âŒ         âŒ         âœ…         âŒ         âŒ         âœ…         âŒ
Save      âŒ         âŒ         ğŸ’¾         âŒ         âŒ         ğŸ’¾         âŒ
Ensemble  M1          M1         M2         M2         M2         M3         M3
--------------------------------------------------------------------------------------------
BACKTEST (Hybrid)
Fetch     âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Features  âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Labels    âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Predict   âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Sim Trade âœ…         âœ…         âœ…         âœ…         âœ…         âœ…         âœ…
Retrain   âŒ         âŒ         âœ…         âŒ         âŒ         âœ…         âŒ
Save      âŒ         âŒ         ğŸ’¾         âŒ         âŒ         ğŸ’¾         âŒ
Ensemble  M1          M1         M2         M2         M2         M3         M3
Equity â†‘  10000      10050      10120      10120      10180      10250      10250





# XMâ€“MT5 AI/ML Trading Bot (Demo)

1. Create and fund an XM **demo** account.
2. Fill `.env` with login/server.
3. Edit `config.yaml` for symbols/timeframe.
4. `pip install -r requirements.txt`
5. `python main.py` (runs a simple live loop on demo).

**Backtest:** see `src/backtest.py` example.

**WARNING:** For demo use only. Markets are risky.